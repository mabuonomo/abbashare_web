{"version":3,"sources":["../src/util/input_validation.ts"],"names":[],"mappings":"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","file":"input_validation.js","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fail } from './assert';\nimport { Code, FirestoreError } from './error';\nimport { AnyJs } from './misc';\nimport * as obj from './obj';\n\n/**\n * Validates the invocation of functionName has the exact number of arguments.\n *\n * Forward the magic \"arguments\" variable as second parameter on which the\n * parameter validation is performed:\n * validateExactNumberOfArgs('myFunction', arguments, 2);\n */\nexport function validateExactNumberOfArgs(\n  functionName: string,\n  args: IArguments,\n  numberOfArgs: number\n): void {\n  if (args.length !== numberOfArgs) {\n    throw new FirestoreError(\n      Code.INVALID_ARGUMENT,\n      `Function ${functionName}() requires ` +\n        formatPlural(numberOfArgs, 'argument') +\n        ', but was called with ' +\n        formatPlural(args.length, 'argument') +\n        '.'\n    );\n  }\n}\n\n/**\n * Validates the invocation of functionName has at least the provided number of\n * arguments (but can have many more).\n *\n * Forward the magic \"arguments\" variable as second parameter on which the\n * parameter validation is performed:\n * validateAtLeastNumberOfArgs('myFunction', arguments, 2);\n */\nexport function validateAtLeastNumberOfArgs(\n  functionName: string,\n  args: IArguments,\n  minNumberOfArgs: number\n): void {\n  if (args.length < minNumberOfArgs) {\n    throw new FirestoreError(\n      Code.INVALID_ARGUMENT,\n      `Function ${functionName}() requires at least ` +\n        formatPlural(minNumberOfArgs, 'argument') +\n        ', but was called with ' +\n        formatPlural(args.length, 'argument') +\n        '.'\n    );\n  }\n}\n\n/**\n * Validates the invocation of functionName has number of arguments between\n * the values provided.\n *\n * Forward the magic \"arguments\" variable as second parameter on which the\n * parameter validation is performed:\n * validateBetweenNumberOfArgs('myFunction', arguments, 2, 3);\n */\nexport function validateBetweenNumberOfArgs(\n  functionName: string,\n  args: IArguments,\n  minNumberOfArgs: number,\n  maxNumberOfArgs: number\n): void {\n  if (args.length < minNumberOfArgs || args.length > maxNumberOfArgs) {\n    throw new FirestoreError(\n      Code.INVALID_ARGUMENT,\n      `Function ${functionName}() requires between ${minNumberOfArgs} and ` +\n        `${maxNumberOfArgs} arguments, but was called with ` +\n        formatPlural(args.length, 'argument') +\n        '.'\n    );\n  }\n}\n\n/**\n * Validates the provided argument is an array and has as least the expected\n * number of elements.\n */\nexport function validateNamedArrayAtLeastNumberOfElements<T>(\n  functionName: string,\n  value: T[],\n  name: string,\n  minNumberOfElements: number\n): void {\n  if (!(value instanceof Array) || value.length < minNumberOfElements) {\n    throw new FirestoreError(\n      Code.INVALID_ARGUMENT,\n      `Function ${functionName}() requires its ${name} argument to be an ` +\n        'array with at least ' +\n        `${formatPlural(minNumberOfElements, 'element')}.`\n    );\n  }\n}\n\n/**\n * Validates the provided positional argument has the native JavaScript type\n * using typeof checks.\n */\nexport function validateArgType(\n  functionName: string,\n  type: string,\n  position: number,\n  argument: AnyJs\n): void {\n  validateType(functionName, type, `${ordinal(position)} argument`, argument);\n}\n\n/**\n * Validates the provided argument has the native JavaScript type using\n * typeof checks or is undefined.\n */\nexport function validateOptionalArgType(\n  functionName: string,\n  type: string,\n  position: number,\n  argument: AnyJs\n): void {\n  if (argument !== undefined) {\n    validateArgType(functionName, type, position, argument);\n  }\n}\n\n/**\n * Validates the provided named option has the native JavaScript type using\n * typeof checks.\n */\nexport function validateNamedType(\n  functionName: string,\n  type: string,\n  optionName: string,\n  argument: AnyJs\n) {\n  validateType(functionName, type, `${optionName} option`, argument);\n}\n\n/**\n * Validates the provided named option has the native JavaScript type using\n * typeof checks or is undefined.\n */\nexport function validateNamedOptionalType(\n  functionName: string,\n  type: string,\n  optionName: string,\n  argument: AnyJs\n) {\n  if (argument !== undefined) {\n    validateNamedType(functionName, type, optionName, argument);\n  }\n}\n\n/** Helper to validate the type of a provided input. */\nfunction validateType(\n  functionName: string,\n  type: string,\n  inputName: string,\n  input: AnyJs\n) {\n  if (typeof input !== type || (type === 'object' && !isPlainObject(input))) {\n    const description = valueDescription(input);\n    throw new FirestoreError(\n      Code.INVALID_ARGUMENT,\n      `Function ${functionName}() requires its ${inputName} ` +\n        `to be of type ${type}, but it was: ${description}`\n    );\n  }\n}\n\n/**\n * Returns true iff it's a non-null object without a custom prototype\n * (i.e. excludes Array, Date, etc.).\n */\nexport function isPlainObject(input: AnyJs) {\n  return (\n    typeof input === 'object' &&\n    input !== null &&\n    Object.getPrototypeOf(input) === Object.prototype\n  );\n}\n\n/** Returns a string describing the type / value of the provided input. */\nexport function valueDescription(input: AnyJs) {\n  if (input === undefined) {\n    return 'undefined';\n  } else if (input === null) {\n    return 'null';\n  } else if (typeof input === 'string') {\n    if (input.length > 20) {\n      input = `${input.substring(0, 20)}...`;\n    }\n    return JSON.stringify(input);\n  } else if (typeof input === 'number' || typeof input === 'boolean') {\n    return '' + input;\n  } else if (typeof input === 'object') {\n    if (input instanceof Array) {\n      return 'an array';\n    } else {\n      const customObjectName = tryGetCustomObjectType(input);\n      if (customObjectName) {\n        return `a custom ${customObjectName} object`;\n      } else {\n        return 'an object';\n      }\n    }\n  } else if (typeof input === 'function') {\n    return 'a function';\n  } else {\n    return fail('Unknown wrong type: ' + typeof input);\n  }\n}\n\n/** Hacky method to try to get the constructor name for an object. */\nexport function tryGetCustomObjectType(input: object): string | null {\n  if (input.constructor) {\n    const funcNameRegex = /function\\s+([^\\s(]+)\\s*\\(/;\n    const results = funcNameRegex.exec(input.constructor.toString());\n    if (results && results.length > 1) {\n      return results[1];\n    }\n  }\n  return null;\n}\n\n/** Validates the provided argument is defined. */\nexport function validateDefined(\n  functionName: string,\n  position: number,\n  argument: AnyJs\n): void {\n  if (argument === undefined) {\n    throw new FirestoreError(\n      Code.INVALID_ARGUMENT,\n      `Function ${functionName}() requires a valid ${ordinal(position)} ` +\n        `argument, but it was undefined.`\n    );\n  }\n}\n\n/**\n * Validates the provided positional argument is an object, and its keys and\n * values match the expected keys and types provided in optionTypes.\n */\nexport function validateOptionNames(\n  functionName: string,\n  options: object,\n  optionNames: string[]\n) {\n  obj.forEach(options as obj.Dict<AnyJs>, (key, _) => {\n    if (optionNames.indexOf(key) < 0) {\n      throw new FirestoreError(\n        Code.INVALID_ARGUMENT,\n        `Unknown option '${key}' passed to function ${functionName}(). ` +\n          'Available options: ' +\n          optionNames.join(', ')\n      );\n    }\n  });\n}\n\n/**\n * Helper method to throw an error that the provided argument did not pass\n * an instanceof check.\n */\nexport function invalidClassError(\n  functionName: string,\n  type: string,\n  position: number,\n  argument: AnyJs\n): Error {\n  const description = valueDescription(argument);\n  return new FirestoreError(\n    Code.INVALID_ARGUMENT,\n    `Function ${functionName}() requires its ${ordinal(position)} ` +\n      `argument to be a ${type}, but it was: ${description}`\n  );\n}\n\n/** Converts a number to its english word representation */\nfunction ordinal(num: number) {\n  switch (num) {\n    case 1:\n      return 'first';\n    case 2:\n      return 'second';\n    case 3:\n      return 'third';\n    default:\n      return num + 'th';\n  }\n}\n\n/**\n * Formats the given word as plural conditionally given the preceding number.\n */\nfunction formatPlural(num: number, str: string) {\n  return `${num} ${str}` + (num === 1 ? '' : 's');\n}\n"]}