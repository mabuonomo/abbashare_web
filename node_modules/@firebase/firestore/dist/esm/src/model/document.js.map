{"version":3,"sources":["../src/model/document.ts"],"names":[],"mappings":"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","file":"document.js","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SnapshotVersion } from '../core/snapshot_version';\nimport { fail } from '../util/assert';\nimport { AnyJs } from '../util/misc';\n\nimport { DocumentKey } from './document_key';\nimport { FieldValue, JsonObject, ObjectValue } from './field_value';\nimport { FieldPath } from './path';\n\nexport interface DocumentOptions {\n  hasLocalMutations: boolean;\n}\n\nexport class Document {\n  readonly hasLocalMutations: boolean;\n\n  constructor(\n    readonly key: DocumentKey,\n    readonly version: SnapshotVersion,\n    readonly data: ObjectValue,\n    options: DocumentOptions\n  ) {\n    this.hasLocalMutations = options.hasLocalMutations;\n  }\n\n  field(path: FieldPath): FieldValue {\n    return this.data.field(path);\n  }\n\n  fieldValue(path: FieldPath): AnyJs {\n    const field = this.field(path);\n    return field ? field.value() : undefined;\n  }\n\n  value(): JsonObject<AnyJs> {\n    return this.data.value();\n  }\n\n  equals(other: Document | null | undefined): boolean {\n    return (\n      other instanceof Document &&\n      this.key.equals(other.key) &&\n      this.version.equals(other.version) &&\n      this.data.equals(other.data) &&\n      this.hasLocalMutations === other.hasLocalMutations\n    );\n  }\n\n  toString(): string {\n    return (\n      `Document(${this.key}, ${this.version}, ${this.data.toString()}, ` +\n      `{hasLocalMutations: ${this.hasLocalMutations}})`\n    );\n  }\n\n  static compareByKey(d1: MaybeDocument, d2: MaybeDocument): number {\n    return DocumentKey.comparator(d1.key, d2.key);\n  }\n\n  static compareByField(field: FieldPath, d1: Document, d2: Document): number {\n    const v1 = d1.field(field);\n    const v2 = d2.field(field);\n    if (v1 !== undefined && v2 !== undefined) {\n      return v1.compareTo(v2);\n    } else {\n      return fail(\"Trying to compare documents on fields that don't exist\");\n    }\n  }\n}\n\n/**\n * A class representing a deleted document.\n * Version is set to 0 if we don't point to any specific time, otherwise it\n * denotes time we know it didn't exist at.\n */\nexport class NoDocument {\n  constructor(readonly key: DocumentKey, readonly version: SnapshotVersion) {}\n\n  toString(): string {\n    return `NoDocument(${this.key}, ${this.version})`;\n  }\n\n  public equals(other: NoDocument): boolean {\n    return (\n      other && other.version.equals(this.version) && other.key.equals(this.key)\n    );\n  }\n\n  static compareByKey(d1: MaybeDocument, d2: MaybeDocument): number {\n    return DocumentKey.comparator(d1.key, d2.key);\n  }\n}\n\n/**\n * A union type representing either a full document or a deleted document.\n * The NoDocument is used when it doesn't exist on the server.\n */\nexport type MaybeDocument = Document | NoDocument;\n"]}